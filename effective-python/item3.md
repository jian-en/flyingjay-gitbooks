# 了解bytes, str 和 unicode的区别

关于编码的问题，确实很让人头痛，有时候出现问题，可能都只是查查资料，然后拷贝代码，我还是坚信First principle的思维，一件事情总是要从根上去思考，再一层层建构认知，可能才会获得真知，可能开始有这么几个问题：

1. 我们看到的字母A，计算机怎么识别出来的？
2. 计算机传输的二进制数字，对于屏幕怎么知道把多长的数字，多大的数字对应成某个字母？


# ASCII

计算机这玩意是美国人发明的东西，那最开始就用8-bit也就是一个字节(byte)来表示一个字符，最开始也没有用到那么多，就用了7-bit，也就是从0~127来表示所有的英文字符啊，标点符号啊，这就是最开始的情况，这个系统被称为ASCII(第一个字母是American 这是美国人制定的标准)。

随后问题就来了：

naïve或者café 这样从法国等西语国家来的词怎么办？直接写成cafe，法国人真是不愿意啊

# Code Page时代

接下来解决问题的方式就很自然，8-bit只用了128个，还有128没用呢，干脆直接用了。比如希伯来语来一套，法语来一套....因此国际上以及一些公司出了各种各样的版本来解决这个问题，就像每人手里都有一个code page，来查看某个byte到底对应什么样的字符。

问题又来了：

各家有各家的标准，那一个文件从一台机器跑到另一台机器上，岂不是都乱掉了？其次如果一篇文档中间既有法语又有希伯来语，计算机该怎么办？最后像中文这样复杂的东方语言，岂是200多个数字能够表示完的。

# Unicode 呼之欲出
1980年左右，国际上搞出了unicode概念，顾名思义就是要把尽可能多的语言和文字纳入到计算机中，开始从1个byte扩展到2个byte，那么就有65，536种不同的表示方法，最后还不够又增加了几个bit直接到能表示1百万左右的字符（作为对比，汉字的个数大概是6万多），那么简单了，这么多数字肯定可以囊括所有的字符。

问题又来了：

计算机存储的就是0或者1，那么我们怎么知道一连串数字 11010110... 到底对应什么字符呢？

# UTF-16等编码格式

最直觉性的思维是：那我就取一个定长的二进制码，比如16位（此时计算机已经高速发展），和每一个字符做一一对应关系（这个一一对应关系，有unicode来维护），那每个字符就有唯一一个16位的二进制码对应。这问题不就解决了吗？这就是早期的UTF-16的思想。

问题还是又来了：

对于:

```
Hello
```

这样简单的字符，也要用16位来表示？那必然有很多位都是0啊，这样岂不是特别占空间，网络传输也费劲啊。其次，现在已有的ASCII编码的文件，我们怎么做到向下兼容（看来那时候的科学家已经开始意识到早期自己挖的坑了）

# UTF-8编码标准

UTF-8 一键式解决所有问题，我们先不看细节，依然用一个byte一个byte来表示字符，那有人就说了，那不就只能表示256个字符吗？这中间有个小技巧，就是用特殊的byte来表示用几个byte共同表示一个字符。哈哈，所以这是一个绝妙的解决方案，正因为有了这个标识符，兼容之前ASCII的文件就用一个byte而其他文字就灵活调整，可长可短，怪不得最后UTF－8流行起来了。

接下来回到正题，python2中有两种方式表示一串字符：

* str: 是所谓的8-bit字符，比如我们看到所有'', ""中的内容，所以只能是ASCII编码的
* unicode: 是unicode字符，经常会用u''表示

对应python3对应两种方式:

* bytes: 是所谓的8-bit, 对应python2中的str
* str:   都是unicode，对应python2中的unicode

这也是为什么Django中是这样写的了：

```
def __unicode__():  # python2
    pass

def __str__():  # python3
    pass
```

对应两种方法:


```python
# python2
a = u'你好，世界'
a.encode('utf-8')  # 转换成 8-bit byte形式。也就是python2中的str

# python3
a = '你好，世界'
a.encode('utf-8')  # 转换成 8-bit byte形式。也就是python3中的bytes

# python2
a = '\xe4\xbd'
a.decode('utf-8')  # 转换成utf-8编码的unicode形式。也就是python2中的unicode形式


# python3
a = b'\xe4\xbd'
a.decode('utf-8')  # 转换成utf-8编码的unicode形式。也就是python3中的str形式
```

# 注意

Python2中unicode和一般的str形式只要不超过7位的字符都可以进行各种操作，如：相加，比较等，但是python3中bytes和str区分的很清楚，泾渭分明。

# 想法

以后对于python中报有关unicode的错误，我们可以理智思考其中到底存在什么问题，从最本质思考问题，之后遇到此类问题，才能避免浪费一次带宽。
